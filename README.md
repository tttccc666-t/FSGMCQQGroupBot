# 基于 NapCatQQ 框架的 QQ Bot

FSGMC 交流群正在使用的机器人框架。  
一个基于 **Python** + **OneBot 11 (NapCatQQ)** 协议的群聊机器人。  
集成了 **DeepSeek 大模型对话**、**阿里云通义万相 AI 绘图** 以及 **群组自动化管理** 功能。  
拥有可爱的“猫娘”人设，支持戳一戳互动和进群欢迎。  
![MIT License](https://img.shields.io/badge/License-MIT_License-blue "MIT License")
## ✨ 功能特性

### 🧠 AI 智能交互
- **智能聊天**：接入 DeepSeek V3 模型，拥有猫娘人设，支持上下文对话（被 @ 时触发）。
- **AI 绘图**：接入阿里云 `qwen-image-max` 模型，支持高质量文生图。
  - 指令：`/绘画 提示词` 或 `/draw 提示词`。
  - 限制：普通用户每日限 5 次，管理员/主人无限制。
- **趣味互动**：
  - **戳一戳**：双击机器人头像，会随机回复可爱语音/动作。
  - **进群欢迎**：新成员入群自动发送欢迎语。
  - **点赞反馈**：发送“赞我”，机器人会回赞 10 次。

### 🛡️ 群组管理系统
- **违禁词过滤**：
  - 1级（轻微）：禁言 10 分钟。
  - 2级（广告）：禁言 1 小时。
  - 3级（严重）：直接踢出群聊。
  - **自动撤回**：检测到违规消息时，先撤回再处罚。
- **防刷屏机制**：
  - 单条消息超过 300 字 -> 撤回 + 禁言 1 小时。
  - 单条消息超过 10 行 -> 撤回 + 禁言 1 小时。
  - *智能识别：自动过滤 [CQ码]（如表情包），防止误判。*
- **管理员指令**：
  - `/mute QQ号 时间(s/m/h)`：禁言指定用户。
  - `/unmute QQ号`：解除禁言。
  - `111睡觉模式`：一键禁言特定目标 8 小时（强制睡觉）。

## 🛠️ 环境依赖

1. **Python 3.8+**
2. **NapCatQQ** (或其他 OneBot 11 实现)，并创建与配置 **Websocket服务器**。
3. **API Key**:
   - DeepSeek API Key (用于聊天)
   - 阿里云 DashScope API Key (用于绘图)

## 📦 安装与配置

### 1. 安装依赖库

```bash
pip install websocket-client requests
```

### 2. 配置 `main.py`

打开 `main.py`，根据您的实际情况修改顶部的 **配置区域**：

```python
# NapCat 连接配置
WS_URL = "ws://127.0.0.1:2354"  #如果是本机运行，保持默认；若在云端，请填服务器IP
WS_TOKEN = "您的Token"          # NapCat 配置文件中设置的 Token

# 身份配置
BOT_QQ = 12345678      # 机器人的QQ号
OWNER_QQ = 88888888    # 主人(最高权限)的QQ号
TARGET_111_QQ = 0      # "111睡觉模式"的特定迫害对象QQ号

# API 密钥配置
DEEPSEEK_API_KEY = "sk-xxxxxxxx"
DASHSCOPE_API_KEY = "sk-xxxxxxxx" # 阿里云 Key

# 启用的群组 (机器人只会在列表内的群里响应)
ENABLED_GROUPS = [123456789, 987654321]
```

### 3. 启动机器人

确保 NapCatQQ 已经登录并运行，然后在终端执行：

```bash
python main.py
```

看到日志输出 `WebSocket 连接成功` 即表示启动成功。

## 🎮 指令手册

### 👥 普通用户指令

| 指令/动作 | 说明 | 示例 |
| :--- | :--- | :--- |
| **@机器人 内容** | 与 AI 猫娘聊天 | `@瞌睡猫 你好呀` |
| **/绘画 提示词** | AI 生成图片 (每日限5次) | `/绘画 一只在吃鱼的猫` |
| **赞我** | 让机器人给你点赞 | `赞我` |
| **双击头像** | 触发戳一戳互动 | (动作) |
| **(进群)** | 触发欢迎语 | (动作) |

### 👮‍♂️ 管理员/主人指令

| 指令 | 说明 | 示例 |
| :--- | :--- | :--- |
| **/mute** | 禁言用户 | `/mute 123456 10m` (禁言10分钟) |
| **/unmute** | 解禁用户 | `/unmute 123456` |
| **111睡觉模式** | 强制禁言目标用户 8 小时 | `111睡觉模式` |
| **/绘画** | AI 绘图 (无次数限制) | `/绘画 赛博朋克城市` |

## ⚠️ 常见问题

**Q: 启动时报错 `[WinError 10060]` 连接超时？**
A: 请检查 `WS_URL`。如果脚本和 NapCat 在同一台电脑，请使用 `ws://127.0.0.1:2354`。如果不在同一台电脑，请确保服务器防火墙放行了 2354 端口，且 NapCat 监听的是 `0.0.0.0`。

## 📝 免责声明

本项目仅供学习和技术研究使用。请勿用于发送垃圾信息、骚扰他人或进行任何违反法律法规的活动。使用 API 服务（DeepSeek/阿里云）产生的费用由用户自行承担。
