# 基于 NapCatQQ 框架的 QQ Bot

[English](README.en.md) | 中文

**FSGMC 交流群**正在使用的机器人框架。  
一个基于 **Python** + **OneBot 11 (NapCatQQ)** 协议的群聊机器人。  
集成了 **DeepSeek 大模型对话**、**阿里云通义万相 AI 绘图/修图** 以及 **Qwen-VL 视觉识别** 功能。  
拥有可爱的“猫娘”人设，支持戳一戳互动、进群欢迎、**私信聊天**以及**看图说话**。  
![MIT License](https://img.shields.io/badge/License-MIT_License-blue "MIT License")

## ✨ 功能特性

### 🧠 AI 智能交互 (多模态)
- **智能聊天**：接入 DeepSeek V3 模型，拥有猫娘人设。
  - **群聊模式**：被 @ 时触发，能够感知群聊上下文。
  - **私聊模式 (新)**：支持一对一私聊，无需 @，能够区分私聊语境。
- **👀 视觉识别**：接入阿里云 `qwen-vl-plus` 模型。
  - **看图说话**：发送图片并 @机器人（私聊直接发图），它能看懂图片内容并进行回复（例如：“这张图里的猫猫好可爱！”）。
- **🎨 AI 绘图 & 修图 (新)**：
  - **文生图**：接入 `qwen-image` 模型。指令：`/绘画 提示词`。
  - **图生图/改图**：接入 `wan2.5-i2i-preview` 模型。
    - 指令：发送 `/绘画 提示词` 并**附带 1-3 张图片**。
    - 功能：根据提示词修改原图，或进行多图融合。
  - 限制：普通用户每日限 5 次，管理员/主人无限制。
- **趣味互动**：
  - **戳一戳**：双击机器人头像，会随机回复可爱语音/动作。
  - **进群欢迎**：新成员入群自动发送欢迎语。
  - **好友管理**：**自动通过**好友添加请求，并发送问候语。
  - **点赞反馈**：发送“赞我”，机器人会回赞 10 次。

### 🛡️ 群组管理系统
- **违禁词过滤**：
  - 1级（轻微）：禁言 10 分钟。
  - 2级（广告）：禁言 1 小时。
  - 3级（严重）：直接踢出群聊。
  - **自动撤回**：检测到违规消息时，先撤回再处罚。
- **防刷屏机制**：
  - 单条消息超过 1000 字 -> 撤回 + 禁言 1 小时。
  - 单条消息超过 15 行 -> 撤回 + 禁言 1 小时。
  - *智能识别：自动过滤 [CQ码]（如表情包），防止误判。*
- **管理员指令**：
  - `/mute QQ号 时间(s/m/h)`：禁言指定用户。
  - `/unmute QQ号`：解除禁言。
  - `111睡觉模式`：一键禁言特定目标 8 小时（强制睡觉）。

## 🛠️ 环境依赖

1. **Python 3.8+**
2. **NapCatQQ** (或其他 OneBot 11 实现)，并创建与配置 **Websocket服务器**。
3. **API Key**:
   - DeepSeek API Key (用于聊天)
   - 阿里云 DashScope API Key (用于 **绘图**、**修图** 和 **识图**)

## 📦 安装与配置

### 1. 安装依赖库

```bash
pip install websocket-client requests
```

### 2. 配置脚本

打开脚本文件（如 `bot1.py` 或 `main.py`），根据您的实际情况修改顶部的 **配置区域**：

```python
# NapCat 连接配置
WS_URL = "ws://127.0.0.1:2354"  # 如果是本机运行，保持默认；若在云端，请填服务器IP
WS_TOKEN = "您的Token"          # NapCat 配置文件中设置的 Token

# 身份配置
BOT_QQ = 12345678      # 机器人的QQ号
OWNER_QQ = 88888888    # 主人(最高权限)的QQ号

# API 密钥配置
DEEPSEEK_API_KEY = "sk-xxxxxxxx"  # DeepSeek Key
DASHSCOPE_API_KEY = "sk-xxxxxxxx" # 阿里云 Key (必须开通 DashScope 服务)

# 启用的群组 (私聊不受此限制)
ENABLED_GROUPS = [123456789, 987654321]
```

### 3. 启动机器人

确保 NapCatQQ 已经登录并运行，然后在终端执行：

```bash
python bot1.py
```

看到日志输出 `WebSocket 连接成功` 即表示启动成功。

## 🎮 指令手册

### 👥 通用指令 (群聊/私聊)

| 指令/动作 | 说明 | 示例 |
| :--- | :--- | :--- |
| **@机器人 内容** | 与 AI 猫娘聊天 (私聊无需@) | `@瞌睡猫 你好呀` |
| **@机器人 [图片]** | **让 AI 看图说话** | `@瞌睡猫 [图片] 看看这只狗` |
| **/绘画 提示词** | **文生图** (每日限5次) | `/绘画 一只在吃鱼的猫` |
| **/绘画 [图片] 提示词** | **图生图/改图** (需附带图片) | `/绘画 [图片] 变成赛博朋克风格` |
| **赞我** | 让机器人给你点赞 | `赞我` |
| **双击头像** | 触发戳一戳互动 | (动作) |
| **(加好友)** | 自动通过好友请求 | (动作) |

### 👮‍♂️ 管理员/主人指令

| 指令 | 说明 | 示例 |
| :--- | :--- | :--- |
| **/mute** | 禁言用户 | `/mute 123456 10m` (禁言10分钟) |
| **/unmute** | 解禁用户 | `/unmute 123456` |
| **111睡觉模式** | 强制禁言目标用户 8 小时 | `111睡觉模式` |
| **/绘画** | AI 绘图 (无次数限制) | `/绘画 赛博朋克城市` |

## ⚠️ 常见问题

**Q: 图生图/修图失败？**
A: 图生图使用的是阿里云 `wan2.5-i2i-preview` 模型，该接口为异步调用，脚本会自动轮询结果。如果失败，请检查 API Key 是否有权限，或者图片内容是否违规。支持最多上传 3 张图片。

**Q: 发送图片后机器人没反应？**
A: 
1. 确保图片可以正常被外网访问（NapCat 上报的 URL 必须有效）。
2. 确保阿里云 DashScope 账户有余额。

## 📝 免责声明

本项目仅供学习和技术研究使用。请勿用于发送垃圾信息、骚扰他人或进行任何违反法律法规的活动。使用 API 服务（DeepSeek/阿里云）产生的费用由用户自行承担。
